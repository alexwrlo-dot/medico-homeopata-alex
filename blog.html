<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#e0e5ec">
    <title>Blog Completo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg: #e0e5ec; --text: #4a5568; --primary: #06b6d4; --neu-out: 8px 8px 16px #a3b1c6, -8px -8px 16px #ffffff; --neu-in: inset 6px 6px 10px #a3b1c6, inset -6px -6px 10px #ffffff; }
        body { font-family:'Nunito', sans-serif; background:var(--bg); color:var(--text); padding:20px; }
        .neu-card { background:var(--bg); border-radius:20px; box-shadow:var(--neu-out); padding:20px; margin-bottom:20px; }
        .neu-btn { padding:10px 20px; border-radius:50px; background:var(--bg); box-shadow:var(--neu-out); color:var(--primary); font-weight:800; text-decoration:none; border:none; cursor:pointer; }
        .neu-btn:active { box-shadow:var(--neu-in); transform:scale(0.96); }
        input { width:100%; padding:15px; border-radius:50px; background:var(--bg); border:none; box-shadow:var(--neu-in); outline:none; margin-bottom:20px; }
        
        .modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(224,229,236,0.95); display:none; justify-content:center; align-items:center; }
        .modal-content { background:var(--bg); width:90%; max-width:800px; max-height:90vh; border-radius:30px; padding:25px; overflow-y:auto; position:relative; box-shadow:var(--neu-out); }
        .grid { display:grid; grid-template-columns:1fr; gap:20px; }
        @media(min-width:768px){ .grid{grid-template-columns:repeat(3,1fr);} }
        #modal-body img { max-width:100%; border-radius:15px; margin:15px 0; }
    </style>
</head>
<body>

    <div style="max-width:900px; margin:0 auto;">
        <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
            <a href="index.html" class="neu-btn"><i class="fas fa-arrow-left"></i> Volver</a>
            <h1>Biblioteca</h1>
        </header>

        <input type="text" id="search" placeholder="Buscar artículo..." onkeyup="filter()">
        
        <div id="list" class="grid">
            <div class="neu-card" style="text-align:center;">Cargando...</div>
        </div>
    </div>

    <div id="modal" class="modal-overlay">
        <div class="modal-content">
            <button class="neu-btn" style="position:sticky; top:0; float:right;" onclick="closeModal()">X</button>
            <div id="modal-body" style="margin-top:40px;"></div>
        </div>
    </div>

    <script>
        const USER = "alexwrlo-dot"; 
        const REPO = "medico-homeopata-alex";
        let allPosts = [];

        async function init() {
            try {
                const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/blog`);
                const files = await res.json();
                const md = files.filter(f => f.name.endsWith('.md'));
                
                if(md.length === 0) { document.getElementById('list').innerHTML = "No hay artículos."; return; }

                for(let f of md) {
                    const txt = await (await fetch(f.download_url)).text();
                    const parts = txt.split('---');
                    let title = f.name.replace('.md','');
                    let body = txt;
                    if(parts.length >= 3) {
                        const m = parts[1].match(/title:\s*(.*)/);
                        if(m) title = m[1].replace(/["']/g,"");
                        body = parts.slice(2).join('---');
                    }
                    allPosts.push({title, body});
                }
                render(allPosts);
            } catch(e) { document.getElementById('list').innerHTML = "Error."; }
        }

        function render(posts) {
            const list = document.getElementById('list');
            list.innerHTML = "";
            posts.forEach(p => {
                list.innerHTML += `
                    <div class="neu-card">
                        <h3 style="color:#06b6d4;">${p.title}</h3>
                        <p style="font-size:0.8rem; margin:10px 0;">${p.body.replace(/---.*?---/s,'').replace(/[#*]/g,'').substring(0,100)}...</p>
                        <button class="neu-btn" style="width:100%;" onclick='openPost("${p.title.replace(/'/g,"")}")'>Leer</button>
                    </div>`;
            });
        }

        function filter() {
            const term = document.getElementById('search').value.toLowerCase();
            render(allPosts.filter(p => p.title.toLowerCase().includes(term)));
        }

        function openPost(t) {
            const p = allPosts.find(x => x.title === t);
            document.getElementById('modal-body').innerHTML = `<h1>${p.title}</h1>` + marked.parse(p.body);
            document.getElementById('modal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('modal').style.display = 'none'; }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
