<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#e0e5ec">
    <meta name="description" content="Salud y Vitalidad - App Web Dr. Forense">
    <title>Vitalidad & Ciencia</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- CONFIGURACIÓN VISUAL (NEUMORFISMO VIBRANTE) --- */
        :root {
            --bg: #e0e5ec;
            --text-main: #4a5568;
            --primary: #06b6d4; /* Cian */
            --secondary: #f43f5e; /* Coral */
            --gradient: linear-gradient(135deg, #06b6d4, #3b82f6);
            
            /* Sombras Neumórficas */
            --shadow-light: #ffffff;
            --shadow-dark: #a3b1c6;
            
            --neu-out: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
            --neu-in: inset 6px 6px 10px var(--shadow-dark), inset -6px -6px 10px var(--shadow-light);
            
            --radius: 20px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        /* CORRECCIÓN DE DESBORDAMIENTO */
        html, body {
            width: 100%;
            overflow-x: hidden;
            position: relative;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            padding-bottom: 100px;
        }

        /* --- COMPONENTES UI --- */
        .neu-card {
            background: var(--bg);
            border-radius: var(--radius);
            box-shadow: var(--neu-out);
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.4);
            width: 100%;
            transition: transform 0.2s ease;
        }
        
        .neu-btn {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 12px 20px;
            border-radius: 50px;
            background: var(--bg);
            box-shadow: var(--neu-out);
            color: var(--primary);
            font-weight: 800;
            text-decoration: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            width: auto;
            user-select: none;
            transition: all 0.2s;
        }
        
        .neu-btn.primary { background: var(--gradient); color: white; }
        .neu-btn.secondary { color: var(--secondary); }
        .neu-btn:active { box-shadow: var(--neu-in); transform: scale(0.96); }

        /* Inputs */
        input, select, textarea {
            width: 100%; padding: 12px; border-radius: 12px;
            background: var(--bg); border: none;
            box-shadow: var(--neu-in);
            color: var(--text-main);
            margin-bottom: 15px; outline: none;
            font-family: inherit; font-size: 16px;
        }
        input:focus, textarea:focus { box-shadow: var(--neu-in), 0 0 0 1px var(--primary); }

        /* --- NAVEGACIÓN --- */
        .nav-bar {
            position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%);
            width: 92%; max-width: 400px;
            background: var(--bg);
            border-radius: 30px;
            box-shadow: var(--neu-out);
            display: flex; justify-content: space-evenly; align-items: center;
            padding: 8px 0; z-index: 1000;
        }

        .nav-item {
            color: #a0aec0; font-size: 1.2rem;
            width: 45px; height: 45px;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            transition: 0.3s; text-decoration: none;
        }
        .nav-item.active { color: var(--secondary); box-shadow: var(--neu-in); }

        /* --- MODAL (LECTOR) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(224, 229, 236, 0.95);
            z-index: 2000; display: none;
            justify-content: center; align-items: flex-end;
            padding: 0;
            opacity: 0; transition: opacity 0.3s;
        }

        .modal-overlay.show { display: flex; opacity: 1; }

        .modal-content {
            background: var(--bg);
            width: 100%; height: 90vh;
            border-top-left-radius: 30px; border-top-right-radius: 30px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.15);
            padding: 25px;
            overflow-y: auto;
            position: relative;
        }

        .close-modal-btn {
            position: sticky; top: 0; right: 0; float: right;
            width: 40px; height: 40px; border-radius: 50%;
            background: var(--bg); box-shadow: var(--neu-out);
            display: flex; align-items: center; justify-content: center;
            color: var(--secondary); cursor: pointer; border: none; z-index: 10;
        }

        /* Estilos dentro del Post */
        #modal-body img { max-width: 100%; border-radius: 15px; margin: 10px 0; box-shadow: var(--neu-out); }
        #modal-body h1 { color: var(--primary); line-height: 1.2; margin-bottom: 10px; }
        #modal-body h2, #modal-body h3 { color: var(--text-main); margin-top: 20px; }
        #modal-body p { margin-bottom: 15px; color: #4a5568; line-height: 1.6; }

        /* --- GRID RESPONSIVO --- */
        .container { 
            padding: 20px 15px; 
            width: 100%; max-width: 900px; 
            margin: 0 auto; 
        }

        .grid-responsive { 
            display: grid; 
            grid-template-columns: 1fr; /* Móvil: 1 columna */
            gap: 25px; 
        }

        .price-tag { font-size: 1.2rem; font-weight: 800; display: block; margin: 10px 0; }
        
        /* FONDO */
        .bg-decor { position: fixed; top:0; left:0; width: 100%; height: 100%; z-index: -1; pointer-events: none; overflow: hidden;}
        .blob { position: absolute; border-radius: 50%; filter: blur(70px); opacity: 0.5; }

        /* PC / TABLET */
        @media (min-width: 768px) {
            .nav-bar { top: 20px; bottom: auto; width: 500px; }
            body { padding-top: 80px; padding-bottom: 0; }
            .grid-responsive { grid-template-columns: repeat(3, 1fr); }
            .modal-content { 
                height: auto; max-height: 85vh; width: 800px; 
                border-radius: 30px; align-self: center; 
            }
            .modal-overlay { align-items: center; padding: 20px; }
        }
    </style>
</head>
<body>

    <div class="bg-decor">
        <div class="blob" style="top:-50px; right:-50px; width:200px; height:200px; background:rgba(6,182,212,0.3);"></div>
        <div class="blob" style="bottom:10%; left:-50px; width:250px; height:250px; background:rgba(244,63,94,0.2);"></div>
    </div>

    <nav class="nav-bar">
        <a href="#inicio" class="nav-item active"><i class="fas fa-home"></i></a>
        <a href="#blog" class="nav-item"><i class="fas fa-book-medical"></i></a>
        <a href="#tienda" class="nav-item"><i class="fas fa-shopping-cart"></i></a>
        <a href="#contacto" class="nav-item"><i class="fas fa-envelope"></i></a>
    </nav>

    <div id="article-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal-btn" onclick="closeModal()">
                <i class="fas fa-times"></i>
            </button>
            <div id="modal-body" style="margin-top: 10px;"></div>
        </div>
    </div>

    <div class="container">
        
        <section id="inicio" style="text-align: center; padding: 30px 0;">
            <div class="neu-card" style="display:inline-block; padding:8px; border-radius:50%; width: auto;">
                <img src="https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?auto=format&fit=crop&w=150&q=80" 
                     style="width:90px; height:90px; border-radius:50%; object-fit:cover; display:block;" alt="Doctor">
            </div>
            <h1 style="font-size: 2rem; margin-top: 15px; color: #2d3748;">Dr. <span style="color:var(--primary);">Vitalidad</span></h1>
            <p style="color: #718096; margin-bottom: 25px; font-size: 0.95rem;">Medicina Integrativa & Forense</p>
            
            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <a href="#contacto" class="neu-btn primary">Agendar Cita</a>
                <a href="#tienda" class="neu-btn">Ver Recursos</a>
            </div>
        </section>

        <section id="blog">
            <h2 style="color:var(--text-main); margin-bottom:20px; font-size: 1.5rem;">Artículos Recientes</h2>
            <div id="blog-list">
                <div class="neu-card" style="text-align:center;">
                    <i class="fas fa-sync fa-spin" style="color:var(--primary);"></i> Cargando artículos...
                </div>
            </div>
        </section>

        <section id="tienda">
            <h2 style="color:var(--text-main); margin-bottom:20px; font-size: 1.5rem;">Tienda Digital</h2>
            
            <div class="grid-responsive">
                <div class="neu-card" style="text-align:center;">
                    <i class="fas fa-headphones-alt fa-2x" style="color:var(--primary); margin-bottom:10px;"></i>
                    <h3>Neuro-Audio</h3>
                    <p style="font-size:0.85rem; color:#718096;">Reprogramación mental.</p>
                    <span class="price-tag">$19.99</span>
                    <button class="neu-btn secondary" style="width:100%;" onclick="buyProduct('Neuro-Audio', '19.99')">
                        <i class="fab fa-whatsapp" style="margin-right:8px;"></i> Comprar
                    </button>
                </div>

                <div class="neu-card" style="text-align:center;">
                    <i class="fas fa-first-aid fa-2x" style="color:var(--secondary); margin-bottom:10px;"></i>
                    <h3>Botiquín PDF</h3>
                    <p style="font-size:0.85rem; color:#718096;">Guía primeros auxilios.</p>
                    <span class="price-tag">$9.99</span>
                    <button class="neu-btn secondary" style="width:100%;" onclick="buyProduct('Guía Botiquín', '9.99')">
                        <i class="fab fa-whatsapp" style="margin-right:8px;"></i> Comprar
                    </button>
                </div>

                <div class="neu-card" style="text-align:center;">
                    <i class="fas fa-user-md fa-2x" style="color:var(--primary); margin-bottom:10px;"></i>
                    <h3>Consulta Online</h3>
                    <p style="font-size:0.85rem; color:#718096;">Sesión Zoom 45min.</p>
                    <span class="price-tag">$45.00</span>
                    <button class="neu-btn secondary" style="width:100%;" onclick="buyProduct('Consulta Online', '45.00')">
                        <i class="fab fa-whatsapp" style="margin-right:8px;"></i> Agendar
                    </button>
                </div>
            </div>
        </section>

        <section id="contacto">
            <h2 style="color:var(--text-main); margin-bottom:20px; font-size: 1.5rem;">Contacto</h2>
            <div class="neu-card">
                <form action="https://formspree.io/f/xgoweoqp" method="POST" id="contact-form">
                    <label style="font-size:0.9rem; margin-left:5px;">Nombre</label>
                    <input type="text" name="name" required placeholder="Tu nombre">
                    
                    <label style="font-size:0.9rem; margin-left:5px;">Email</label>
                    <input type="email" name="email" required placeholder="tu@email.com">
                    
                    <label style="font-size:0.9rem; margin-left:5px;">Mensaje</label>
                    <textarea name="message" rows="3" placeholder="Escribe aquí..."></textarea>
                    
                    <button type="submit" class="neu-btn primary" style="width:100%;">Enviar</button>
                    <div id="form-status" style="margin-top:15px; text-align:center; display:none;"></div>
                </form>
            </div>
        </section>

    </div>

    <script>
        // --- CONFIGURACIÓN ---
        const WHATSAPP_NUMBER = "5215555555555"; // Pon tu número real
        const GITHUB_USER = "alexwrlo-dot";
        const GITHUB_REPO = "medico-homeopata-alex";
        const BLOG_FOLDER = "blog"; // Carpeta donde el CMS guarda los posts
        
        let loadedPosts = [];

        // --- CARGADOR DE BLOG INTELIGENTE (Soporta CMS Frontmatter) ---
        async function loadBlog() {
            const list = document.getElementById('blog-list');
            try {
                // Petición a la API de GitHub para leer la carpeta 'blog'
                const res = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${BLOG_FOLDER}`);
                const files = await res.json();
                
                if (!res.ok) throw new Error();
                
                list.innerHTML = ""; 
                loadedPosts = []; 
                
                // Filtramos solo archivos .md y tomamos los 5 primeros
                const recentFiles = files.filter(f => f.name.endsWith('.md')).slice(0, 5);

                if(recentFiles.length === 0) {
                    list.innerHTML = "<div class='neu-card'><p>Aún no hay artículos publicados.</p></div>";
                    return;
                }

                for(let i = 0; i < recentFiles.length; i++) {
                    const f = recentFiles[i];
                    const contentRes = await fetch(f.download_url);
                    const rawText = await contentRes.text();
                    
                    // --- PARSEO DE FRONTMATTER (Metadatos del CMS) ---
                    // Separamos lo que está entre --- y --- del contenido real
                    const parts = rawText.split('---');
                    let title = f.name.replace('.md','').replace(/-/g,' '); // Título por defecto (nombre archivo)
                    let body = rawText; // Cuerpo por defecto (todo el texto)

                    if (parts.length >= 3) {
                        // Si tiene frontmatter, extraemos el título real si existe
                        const metadata = parts[1];
                        const titleMatch = metadata.match(/title:\s*(.*)/);
                        if (titleMatch) title = titleMatch[1].replace(/["']/g, "").trim();
                        
                        // El cuerpo es todo lo que sigue después del segundo ---
                        body = parts.slice(2).join('---');
                    }

                    // Guardamos el post procesado en memoria
                    loadedPosts.push({ title: title, content: body });
                    
                    // Creamos la tarjeta visual
                    const card = document.createElement('div');
                    card.className = "neu-card";
                    card.innerHTML = `
                        <h3 style="color:var(--primary); font-size:1.1rem; margin-bottom:10px; line-height:1.3;">
                            ${title}
                        </h3>
                        <div style="font-size:0.85rem; color:#718096; margin-bottom:15px; height: 60px; overflow: hidden;">
                            ${marked.parse(body).replace(/<[^>]*>?/gm, '').substring(0, 90)}...
                        </div>
                        <button class="neu-btn" style="padding:10px; width:100%; font-size:0.85rem;" onclick="openArticle(${i})">
                            Leer Artículo
                        </button>
                    `;
                    list.appendChild(card);
                }
            } catch (e) {
                console.error(e);
                list.innerHTML = `<div class="neu-card"><p>No se pudo conectar con el blog.</p></div>`;
            }
        }

        // --- LÓGICA DE LA VENTANA MODAL ---
        const modal = document.getElementById('article-modal');
        const modalBody = document.getElementById('modal-body');

        function openArticle(index) {
            const post = loadedPosts[index];
            if(!post) return;
            
            // Inyectamos el contenido convertido a HTML
            modalBody.innerHTML = `
                <h1 style="font-size:1.8rem; margin-bottom:20px;">${post.title}</h1>
                <div>${marked.parse(post.content)}</div>
            `;
            
            modal.style.display = 'flex';
            setTimeout(() => { modal.classList.add('show'); }, 10);
            document.body.style.overflow = 'hidden'; // Bloquear scroll de fondo
        }

        function closeModal() {
            modal.classList.remove('show');
            setTimeout(() => { modal.style.display = 'none'; }, 300);
            document.body.style.overflow = 'auto'; // Restaurar scroll
        }

        // Cerrar al tocar fuera del contenido
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });

        // --- OTRAS FUNCIONES (Tienda, Nav, Form) ---
        function buyProduct(product, price) {
            const msg = `Hola Dr., deseo comprar: ${product} ($${price}).`;
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        // Scroll espía para el menú
        const navItems = document.querySelectorAll(".nav-item");
        window.addEventListener("scroll", () => {
            let current = "";
            document.querySelectorAll("section").forEach((section) => {
                const sectionTop = section.offsetTop;
                if (pageYOffset >= (sectionTop - 300)) current = section.getAttribute("id");
            });
            navItems.forEach((item) => {
                item.classList.remove("active");
                if (item.getAttribute("href").includes(current)) item.classList.add("active");
            });
        });

        // Envío de Formulario
        const form = document.getElementById("contact-form");
        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const btn = form.querySelector("button");
            const status = document.getElementById("form-status");
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
            
            try {
                const res = await fetch(e.target.action, { 
                    method: 'POST', 
                    body: new FormData(e.target), 
                    headers: { 'Accept': 'application/json' } 
                });
                
                if(res.ok) {
                    status.innerText = "¡Mensaje Enviado!"; 
                    status.style.color = "#10b981"; 
                    status.style.display = "block"; 
                    form.reset();
                } else throw new Error();
            } catch {
                status.innerText = "Error al enviar."; 
                status.style.color = "#ef4444"; 
                status.style.display = "block";
            } finally {
                btn.innerHTML = originalText;
            }
        });

        // Iniciar
        document.addEventListener('DOMContentLoaded', loadBlog);
    </script>
</body>
</html>
